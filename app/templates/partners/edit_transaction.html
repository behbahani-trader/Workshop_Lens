{% extends "base.html" %}

{% block title %}ÙˆÛŒØ±Ø§ÛŒØ´ ØªØ±Ø§Ú©Ù†Ø´ - {{ partner.name }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <!-- Header -->
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
        <div>
            <h1 class="text-3xl font-bold text-base-content mb-2">âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´ ØªØ±Ø§Ú©Ù†Ø´</h1>
            <div class="breadcrumbs text-sm">
                <ul>
                    <li><a href="{{ url_for('main.index') }}" class="text-primary hover:text-primary-focus">Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</a></li>
                    <li><a href="{{ url_for('partners.index') }}" class="text-primary hover:text-primary-focus">Ø´Ø±Ú©Ø§</a></li>
                    <li><a href="{{ url_for('partners.show', id=partner.id) }}" class="text-primary hover:text-primary-focus">{{ partner.name }}</a></li>
                    <li>ÙˆÛŒØ±Ø§ÛŒØ´ ØªØ±Ø§Ú©Ù†Ø´</li>
                </ul>
            </div>
        </div>
        <div class="flex gap-2 mt-4 md:mt-0">
            <a href="{{ url_for('partners.show', id=partner.id) }}" class="btn btn-outline">
                <span class="ml-2">â†©ï¸</span>
                Ø¨Ø§Ø²Ú¯Ø´Øª
            </a>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- ÙØ±Ù… ÙˆÛŒØ±Ø§ÛŒØ´ -->
        <div class="lg:col-span-2">
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <h2 class="card-title text-xl mb-6">ğŸ“ ÙˆÛŒØ±Ø§ÛŒØ´ ØªØ±Ø§Ú©Ù†Ø´</h2>

                    <form method="POST" class="space-y-6">
                        <!-- Ù†ÙˆØ¹ ØªØ±Ø§Ú©Ù†Ø´ -->
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-medium">Ù†ÙˆØ¹ ØªØ±Ø§Ú©Ù†Ø´</span>
                                <span class="label-text-alt text-error">*</span>
                            </label>
                            <div class="flex gap-4">
                                <label class="label cursor-pointer">
                                    <input type="radio" name="transaction_type" value="deposit" 
                                           class="radio radio-success" 
                                           {{ 'checked' if transaction.transaction_type == 'deposit' else '' }} required>
                                    <span class="label-text ml-2">ğŸ’° ÙˆØ§Ø±ÛŒØ²</span>
                                </label>
                                <label class="label cursor-pointer">
                                    <input type="radio" name="transaction_type" value="withdrawal" 
                                           class="radio radio-error" 
                                           {{ 'checked' if transaction.transaction_type == 'withdrawal' else '' }} required>
                                    <span class="label-text ml-2">ğŸ’¸ Ø¨Ø±Ø¯Ø§Ø´Øª</span>
                                </label>
                            </div>
                        </div>

                        <!-- Ù…Ø¨Ù„Øº -->
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-medium">Ù…Ø¨Ù„Øº (ØªÙˆÙ…Ø§Ù†)</span>
                                <span class="label-text-alt text-error">*</span>
                            </label>
                            <input type="number" name="amount" 
                                   value="{{ transaction.amount|int }}"
                                   placeholder="Ù…Ø¨Ù„Øº ØªØ±Ø§Ú©Ù†Ø´ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯..." 
                                   class="input input-bordered" required min="1">
                            <div class="label">
                                <span class="label-text-alt">Ù…Ø¨Ù„Øº Ø¨Ø§ÛŒØ¯ Ø¨ÛŒØ´ØªØ± Ø§Ø² ØµÙØ± Ø¨Ø§Ø´Ø¯</span>
                            </div>
                        </div>

                        <!-- ØªÙˆØ¶ÛŒØ­Ø§Øª -->
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text font-medium">ØªÙˆØ¶ÛŒØ­Ø§Øª</span>
                            </label>
                            <textarea name="description" 
                                      placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª ØªØ±Ø§Ú©Ù†Ø´ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)..."
                                      class="textarea textarea-bordered h-24">{{ transaction.description or '' }}</textarea>
                        </div>

                        <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ -->
                        <div class="flex flex-col sm:flex-row gap-4 pt-4">
                            <button type="submit" class="btn btn-success flex-1">
                                <span class="ml-2">âœ…</span>
                                Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª
                            </button>
                            <a href="{{ url_for('partners.show', id=partner.id) }}" class="btn btn-outline flex-1">
                                <span class="ml-2">âŒ</span>
                                Ø§Ù†ØµØ±Ø§Ù
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø±ÛŒÚ© -->
        <div class="lg:col-span-1">
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <h3 class="card-title text-lg mb-4">ğŸ‘¤ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø±ÛŒÚ©</h3>
                    
                    <div class="space-y-3">
                        <div>
                            <div class="text-sm opacity-70">Ù†Ø§Ù… Ø´Ø±ÛŒÚ©</div>
                            <div class="font-bold">{{ partner.name }}</div>
                        </div>
                        
                        {% if partner.phone %}
                        <div>
                            <div class="text-sm opacity-70">ØªÙ„ÙÙ†</div>
                            <div class="font-medium">{{ partner.phone }}</div>
                        </div>
                        {% endif %}
                        
                        <div>
                            <div class="text-sm opacity-70">Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ</div>
                            <div class="font-bold text-lg {{ 'text-success' if partner.balance >= 0 else 'text-error' }}">
                                {{ "{:,}".format(partner.balance|int) }} ØªÙˆÙ…Ø§Ù†
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØªØ±Ø§Ú©Ù†Ø´ ÙØ¹Ù„ÛŒ -->
            <div class="card bg-base-100 shadow-xl mt-6">
                <div class="card-body">
                    <h3 class="card-title text-lg mb-4">ğŸ“‹ ØªØ±Ø§Ú©Ù†Ø´ ÙØ¹Ù„ÛŒ</h3>
                    
                    <div class="space-y-3">
                        <div>
                            <div class="text-sm opacity-70">Ù†ÙˆØ¹</div>
                            <div class="badge {{ 'badge-success' if transaction.transaction_type == 'deposit' else 'badge-error' }}">
                                {{ 'ÙˆØ§Ø±ÛŒØ²' if transaction.transaction_type == 'deposit' else 'Ø¨Ø±Ø¯Ø§Ø´Øª' }}
                            </div>
                        </div>
                        
                        <div>
                            <div class="text-sm opacity-70">Ù…Ø¨Ù„Øº</div>
                            <div class="font-bold">{{ "{:,}".format(transaction.amount|int) }} ØªÙˆÙ…Ø§Ù†</div>
                        </div>
                        
                        <div>
                            <div class="text-sm opacity-70">ØªØ§Ø±ÛŒØ® Ø«Ø¨Øª</div>
                            <div class="text-sm">{{ transaction.jalali_created_at }}</div>
                        </div>
                        
                        {% if transaction.description %}
                        <div>
                            <div class="text-sm opacity-70">ØªÙˆØ¶ÛŒØ­Ø§Øª</div>
                            <div class="text-sm">{{ transaction.description }}</div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// ÙØ±Ù…Øª Ú©Ø±Ø¯Ù† Ù…Ø¨Ù„Øº Ù‡Ù†Ú¯Ø§Ù… ØªØ§ÛŒÙ¾
document.querySelector('input[name="amount"]').addEventListener('input', function(e) {
    let value = e.target.value.replace(/,/g, '');
    if (value && !isNaN(value)) {
        e.target.value = parseInt(value).toLocaleString();
    }
});

// Ø­Ø°Ù Ú©Ø§Ù…Ø§ Ù‚Ø¨Ù„ Ø§Ø² Ø§Ø±Ø³Ø§Ù„ ÙØ±Ù…
document.querySelector('form').addEventListener('submit', function(e) {
    const amountInput = document.querySelector('input[name="amount"]');
    amountInput.value = amountInput.value.replace(/,/g, '');
});
</script>
{% endblock %}
