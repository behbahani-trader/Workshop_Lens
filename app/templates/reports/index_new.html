{% extends "base.html" %}

{% block title %}ฺฏุฒุงุฑุดุงุช ู ุชุญููโูุง{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item">
    <span class="flex items-center gap-2 text-primary">
        <span>๐</span>
        <span>ฺฏุฒุงุฑุดุงุช ู ุชุญููโูุง</span>
    </span>
</li>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <!-- Header -->
    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-8">
        <div>
            <h1 class="text-4xl font-bold mb-2">๐ ฺฏุฒุงุฑุดุงุช ู ุชุญููโูุง</h1>
            <p class="text-base-content/70">ูุดุงูุฏู ุขูุงุฑุ ุฎุฑูุฌ ฺฏุฒุงุฑุดุงุช ู ูุฏุฑุช ูพุดุชุจุงู</p>
        </div>
        <div class="flex gap-2">
            <button class="btn btn-outline" onclick="window.print()">
                <span class="ml-2">๐จ๏ธ</span>
                ฺุงูพ ุตูุญู
            </button>
            <button class="btn btn-info" onclick="refreshStats()">
                <span class="ml-2">๐</span>
                ุจุฑูุฒุฑุณุงู ุขูุงุฑ
            </button>
        </div>
    </div>

    <!-- ุขูุงุฑ ุณุฑุน -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
        <div class="stat bg-gradient-to-r from-primary to-primary-focus text-primary-content shadow-lg rounded-2xl">
            <div class="stat-figure text-primary-content/80">
                <span class="text-3xl">๐</span>
            </div>
            <div class="stat-title text-primary-content/80">ฺฉู ุณูุงุฑุดุงุช</div>
            <div class="stat-value">{{ total_orders }}</div>
            <div class="stat-desc text-primary-content/60">ูุงฺฉุชูุฑ ุชููุฏ ุดุฏู</div>
        </div>

        <div class="stat bg-gradient-to-r from-success to-success-focus text-success-content shadow-lg rounded-2xl">
            <div class="stat-figure text-success-content/80">
                <span class="text-3xl">๐ฅ</span>
            </div>
            <div class="stat-title text-success-content/80">ฺฉู ูุดุชุฑุงู</div>
            <div class="stat-value">{{ total_customers }}</div>
            <div class="stat-desc text-success-content/60">ูุดุชุฑ ุซุจุช ุดุฏู</div>
        </div>

        <div class="stat bg-gradient-to-r from-warning to-warning-focus text-warning-content shadow-lg rounded-2xl">
            <div class="stat-figure text-warning-content/80">
                <span class="text-3xl">๐ฐ</span>
            </div>
            <div class="stat-title text-warning-content/80">ฺฉู ุฏุฑุขูุฏ</div>
            <div class="stat-value text-lg">{{ "{:,}".format(total_revenue) }}</div>
            <div class="stat-desc text-warning-content/60">ุชููุงู</div>
        </div>

        <div class="stat bg-gradient-to-r from-info to-info-focus text-info-content shadow-lg rounded-2xl">
            <div class="stat-figure text-info-content/80">
                <span class="text-3xl">๐</span>
            </div>
            <div class="stat-title text-info-content/80">ุงูุฑูุฒ</div>
            <div class="stat-value">{{ today_orders }}</div>
            <div class="stat-desc text-info-content/60">ุณูุงุฑุด ุฌุฏุฏ</div>
        </div>
    </div>

    <!-- ฺฏุฒุงุฑุดุงุช ุชูุตู -->
    <div class="card bg-base-100 shadow-xl mb-8">
        <div class="card-header bg-primary text-primary-content p-4 rounded-t-2xl">
            <h2 class="card-title">๐ ฺฏุฒุงุฑุดุงุช ุชูุตู</h2>
        </div>
        <div class="card-body">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- ฺฏุฒุงุฑุด ุณูุงุฑุดุงุช -->
                <div class="card bg-base-200 shadow-md">
                    <div class="card-body">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="text-2xl">๐</span>
                            <h3 class="card-title text-lg">ฺฏุฒุงุฑุด ุณูุงุฑุดุงุช</h3>
                        </div>
                        <p class="text-sm text-base-content/70 mb-4">
                            ุดุงูู: ุดูุงุฑู ุณูุงุฑุดุ ูุดุชุฑุ ุชุงุฑุฎุ ูุถุนุชุ ูุจูุบุ ุฌุฒุฆุงุช ุนุฏุณโูุง
                        </p>
                        <div class="flex flex-col gap-2">
                            <a href="{{ url_for('reports.export', type='orders', format='excel') }}" 
                               class="btn btn-primary btn-sm">
                                <span class="ml-1">๐</span>
                                ุฎุฑูุฌ ุงฺฉุณู
                            </a>
                            <a href="{{ url_for('reports.export', type='orders', format='pdf') }}" 
                               class="btn btn-secondary btn-sm">
                                <span class="ml-1">๐</span>
                                ุฎุฑูุฌ PDF
                            </a>
                        </div>
                    </div>
                </div>

                <!-- ฺฏุฒุงุฑุด ูุดุชุฑุงู -->
                <div class="card bg-base-200 shadow-md">
                    <div class="card-body">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="text-2xl">๐ฅ</span>
                            <h3 class="card-title text-lg">ฺฏุฒุงุฑุด ูุดุชุฑุงู</h3>
                        </div>
                        <p class="text-sm text-base-content/70 mb-4">
                            ุดุงูู: ูุงูุ ุชูููุ ุงููุ ุขุฏุฑุณุ ุชุงุฑุฎ ุซุจุชุ ุชุนุฏุงุฏ ุณูุงุฑุดุงุช
                        </p>
                        <div class="flex flex-col gap-2">
                            <a href="{{ url_for('reports.export', type='customers', format='excel') }}" 
                               class="btn btn-primary btn-sm">
                                <span class="ml-1">๐</span>
                                ุฎุฑูุฌ ุงฺฉุณู
                            </a>
                            <a href="{{ url_for('reports.export', type='customers', format='pdf') }}" 
                               class="btn btn-secondary btn-sm">
                                <span class="ml-1">๐</span>
                                ุฎุฑูุฌ PDF
                            </a>
                        </div>
                    </div>
                </div>

                <!-- ฺฏุฒุงุฑุด ูุงู -->
                <div class="card bg-base-200 shadow-md">
                    <div class="card-body">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="text-2xl">๐ฐ</span>
                            <h3 class="card-title text-lg">ฺฏุฒุงุฑุด ูุงู</h3>
                        </div>
                        <p class="text-sm text-base-content/70 mb-4">
                            ุดุงูู: ุฏุฑุขูุฏ ุฑูุฒุงููุ ูุงูุงููุ ูพุฑุฏุงุฎุชโูุงุ ุจุงูโูุงูุฏูโูุง
                        </p>
                        <div class="flex flex-col gap-2">
                            <a href="{{ url_for('reports.export', type='financial', format='excel') }}" 
                               class="btn btn-primary btn-sm">
                                <span class="ml-1">๐</span>
                                ุฎุฑูุฌ ุงฺฉุณู
                            </a>
                            <a href="{{ url_for('reports.export', type='financial', format='pdf') }}" 
                               class="btn btn-secondary btn-sm">
                                <span class="ml-1">๐</span>
                                ุฎุฑูุฌ PDF
                            </a>
                        </div>
                    </div>
                </div>

                <!-- ฺฏุฒุงุฑุด ุงููุงุน ุนุฏุณ -->
                <div class="card bg-base-200 shadow-md">
                    <div class="card-body">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="text-2xl">๐</span>
                            <h3 class="card-title text-lg">ุงููุงุน ุนุฏุณ</h3>
                        </div>
                        <p class="text-sm text-base-content/70 mb-4">
                            ุดุงูู: ูุงูุ ููุชุ ุชูุถุญุงุชุ ุชุนุฏุงุฏ ุงุณุชูุงุฏู
                        </p>
                        <div class="flex flex-col gap-2">
                            <a href="{{ url_for('reports.export', type='lens_types', format='excel') }}" 
                               class="btn btn-primary btn-sm">
                                <span class="ml-1">๐</span>
                                ุฎุฑูุฌ ุงฺฉุณู
                            </a>
                            <a href="{{ url_for('reports.export', type='lens_types', format='pdf') }}" 
                               class="btn btn-secondary btn-sm">
                                <span class="ml-1">๐</span>
                                ุฎุฑูุฌ PDF
                            </a>
                        </div>
                    </div>
                </div>

                <!-- ฺฏุฒุงุฑุด ุงููุงุน ุชุฑุงุด -->
                <div class="card bg-base-200 shadow-md">
                    <div class="card-body">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="text-2xl">โ๏ธ</span>
                            <h3 class="card-title text-lg">ุงููุงุน ุชุฑุงุด</h3>
                        </div>
                        <p class="text-sm text-base-content/70 mb-4">
                            ุดุงูู: ูุงูุ ููุชุ ุชูุถุญุงุชุ ุชุนุฏุงุฏ ุงุณุชูุงุฏู
                        </p>
                        <div class="flex flex-col gap-2">
                            <a href="{{ url_for('reports.export', type='lens_cut_types', format='excel') }}" 
                               class="btn btn-primary btn-sm">
                                <span class="ml-1">๐</span>
                                ุฎุฑูุฌ ุงฺฉุณู
                            </a>
                            <a href="{{ url_for('reports.export', type='lens_cut_types', format='pdf') }}" 
                               class="btn btn-secondary btn-sm">
                                <span class="ml-1">๐</span>
                                ุฎุฑูุฌ PDF
                            </a>
                        </div>
                    </div>
                </div>

                <!-- ฺฏุฒุงุฑุด ุนููฺฉุฑุฏ -->
                <div class="card bg-base-200 shadow-md">
                    <div class="card-body">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="text-2xl">๐</span>
                            <h3 class="card-title text-lg">ฺฏุฒุงุฑุด ุนููฺฉุฑุฏ</h3>
                        </div>
                        <p class="text-sm text-base-content/70 mb-4">
                            ุดุงูู: ุขูุงุฑ ุฑูุฒุงููุ ูุงูุงููุ ููุงุณู ุฏูุฑูโูุง
                        </p>
                        <div class="flex flex-col gap-2">
                            <a href="{{ url_for('reports.export', type='performance', format='excel') }}" 
                               class="btn btn-primary btn-sm">
                                <span class="ml-1">๐</span>
                                ุฎุฑูุฌ ุงฺฉุณู
                            </a>
                            <a href="{{ url_for('reports.export', type='performance', format='pdf') }}" 
                               class="btn btn-secondary btn-sm">
                                <span class="ml-1">๐</span>
                                ุฎุฑูุฌ PDF
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ูููุฏุงุฑูุง ู ุชุญููโูุง -->
    <div class="card bg-base-100 shadow-xl mb-8">
        <div class="card-header bg-secondary text-secondary-content p-4 rounded-t-2xl">
            <h2 class="card-title">๐ ูููุฏุงุฑูุง ู ุชุญููโูุง</h2>
        </div>
        <div class="card-body">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- ูููุฏุงุฑ ุณูุงุฑุดุงุช ุฑูุฒุงูู -->
                <div class="card bg-base-200">
                    <div class="card-body">
                        <h3 class="card-title mb-4">๐ ุณูุงุฑุดุงุช 7 ุฑูุฒ ุงุฎุฑ</h3>
                        <div class="h-64 flex items-center justify-center">
                            <canvas id="dailyOrdersChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- ูููุฏุงุฑ ุฏุฑุขูุฏ ูุงูุงูู -->
                <div class="card bg-base-200">
                    <div class="card-body">
                        <h3 class="card-title mb-4">๐ฐ ุฏุฑุขูุฏ ูุงูุงูู</h3>
                        <div class="h-64 flex items-center justify-center">
                            <canvas id="monthlyRevenueChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- ูููุฏุงุฑ ูุถุนุช ุณูุงุฑุดุงุช -->
                <div class="card bg-base-200">
                    <div class="card-body">
                        <h3 class="card-title mb-4">๐ ูุถุนุช ุณูุงุฑุดุงุช</h3>
                        <div class="h-64 flex items-center justify-center">
                            <canvas id="orderStatusChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- ูููุฏุงุฑ ูุญุจูุจโุชุฑู ุนุฏุณโูุง -->
                <div class="card bg-base-200">
                    <div class="card-body">
                        <h3 class="card-title mb-4">๐ ูุญุจูุจโุชุฑู ุนุฏุณโูุง</h3>
                        <div class="h-64 flex items-center justify-center">
                            <canvas id="popularLensesChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ูพุดุชุจุงูโฺฏุฑ ู ุจุงุฒุงุจ -->
    <div class="card bg-base-100 shadow-xl">
        <div class="card-header bg-warning text-warning-content p-4 rounded-t-2xl">
            <h2 class="card-title">๐พ ูพุดุชุจุงูโฺฏุฑ ู ุจุงุฒุงุจ</h2>
        </div>
        <div class="card-body">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- ุงุฌุงุฏ ูพุดุชุจุงู -->
                <div class="card bg-base-200 shadow-md">
                    <div class="card-body">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="text-2xl">๐พ</span>
                            <h3 class="card-title text-lg">ุงุฌุงุฏ ูพุดุชุจุงู</h3>
                        </div>
                        <p class="text-sm text-base-content/70 mb-4">
                            ฺฉ ูุณุฎู ฺฉุงูู ุงุฒ ุชูุงู ุงุทูุงุนุงุช ุณุณุชู (ุณูุงุฑุดุงุชุ ูุดุชุฑุงูุ ุชูุธูุงุช) ุงุฌุงุฏ ูโุดูุฏ.
                        </p>
                        <div class="alert alert-info mb-4">
                            <span class="text-sm">
                                ๐ก ุชูุตู ูโุดูุฏ ุฑูุฒุงูู ูพุดุชุจุงู ุชูู ฺฉูุฏ
                            </span>
                        </div>
                        <a href="{{ url_for('reports.backup') }}" class="btn btn-primary btn-block">
                            <span class="ml-2">๐พ</span>
                            ุงุฌุงุฏ ูพุดุชุจุงู ุฌุฏุฏ
                        </a>
                    </div>
                </div>

                <!-- ุจุงุฒุงุจ ูพุดุชุจุงู -->
                <div class="card bg-base-200 shadow-md">
                    <div class="card-body">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="text-2xl">๐</span>
                            <h3 class="card-title text-lg">ุจุงุฒุงุจ ูพุดุชุจุงู</h3>
                        </div>
                        <p class="text-sm text-base-content/70 mb-4">
                            ุจุงุฒุงุจ ุงุทูุงุนุงุช ุงุฒ ูุงู ูพุดุชุจุงู. ุชูุงู ุงุทูุงุนุงุช ูุนู ุฌุงฺฏุฒู ุฎูุงูุฏ ุดุฏ.
                        </p>
                        <div class="alert alert-warning mb-4">
                            <span class="text-sm">
                                โ๏ธ ุงู ุนููุงุช ุบุฑูุงุจู ุจุงุฒฺฏุดุช ุงุณุช
                            </span>
                        </div>
                        <form method="POST" action="{{ url_for('reports.restore') }}" enctype="multipart/form-data">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <div class="form-control mb-4">
                                <label class="label">
                                    <span class="label-text font-medium">ุงูุชุฎุงุจ ูุงู ูพุดุชุจุงู</span>
                                </label>
                                <input type="file" name="backup_file" class="file-input file-input-bordered w-full" 
                                       accept=".json" required />
                            </div>
                            <button type="submit" class="btn btn-warning btn-block" 
                                    onclick="return confirm('ุขุง ุงุฒ ุจุงุฒุงุจ ุงุทูุงุนุงุช ุงุทููุงู ุฏุงุฑุฏุ\n\nุชูุงู ุงุทูุงุนุงุช ูุนู ุญุฐู ู ุจุง ุงุทูุงุนุงุช ูพุดุชุจุงู ุฌุงฺฏุฒู ุฎูุงูุฏ ุดุฏ.\n\nุงู ุนููุงุช ุบุฑูุงุจู ุจุงุฒฺฏุดุช ุงุณุช!')">
                                <span class="ml-2">๐</span>
                                ุจุงุฒุงุจ ูพุดุชุจุงู
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // ูููุฏุงุฑ ุณูุงุฑุดุงุช ุฑูุฒุงูู
    const dailyCtx = document.getElementById('dailyOrdersChart').getContext('2d');
    new Chart(dailyCtx, {
        type: 'line',
        data: {
            labels: {{ daily_labels|safe }},
            datasets: [{
                label: 'ุชุนุฏุงุฏ ุณูุงุฑุดุงุช',
                data: {{ daily_data|safe }},
                borderColor: 'rgb(59, 130, 246)',
                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        stepSize: 1
                    }
                }
            }
        }
    });

    // ูููุฏุงุฑ ุฏุฑุขูุฏ ูุงูุงูู
    const monthlyCtx = document.getElementById('monthlyRevenueChart').getContext('2d');
    new Chart(monthlyCtx, {
        type: 'bar',
        data: {
            labels: {{ monthly_labels|safe }},
            datasets: [{
                label: 'ุฏุฑุขูุฏ (ุชููุงู)',
                data: {{ monthly_revenue|safe }},
                backgroundColor: 'rgba(34, 197, 94, 0.8)',
                borderColor: 'rgb(34, 197, 94)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return value.toLocaleString() + ' ุช';
                        }
                    }
                }
            }
        }
    });

    // ูููุฏุงุฑ ูุถุนุช ุณูุงุฑุดุงุช
    const statusCtx = document.getElementById('orderStatusChart').getContext('2d');
    new Chart(statusCtx, {
        type: 'doughnut',
        data: {
            labels: {{ status_labels|safe }},
            datasets: [{
                data: {{ status_data|safe }},
                backgroundColor: [
                    'rgba(59, 130, 246, 0.8)',   // ุฏุฑ ุญุงู ุงูุฌุงู
                    'rgba(34, 197, 94, 0.8)',    // ุชฺฉูู ุดุฏู
                    'rgba(245, 158, 11, 0.8)',   // ุฏุฑ ุงูุชุธุงุฑ
                    'rgba(239, 68, 68, 0.8)'     // ูุบู ุดุฏู
                ],
                borderWidth: 2,
                borderColor: '#fff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });

    // ูููุฏุงุฑ ูุญุจูุจโุชุฑู ุนุฏุณโูุง
    const lensCtx = document.getElementById('popularLensesChart').getContext('2d');
    new Chart(lensCtx, {
        type: 'horizontalBar',
        data: {
            labels: {{ lens_labels|safe }},
            datasets: [{
                label: 'ุชุนุฏุงุฏ ุงุณุชูุงุฏู',
                data: {{ lens_data|safe }},
                backgroundColor: 'rgba(168, 85, 247, 0.8)',
                borderColor: 'rgb(168, 85, 247)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                x: {
                    beginAtZero: true,
                    ticks: {
                        stepSize: 1
                    }
                }
            }
        }
    });
});

// ุชุงุจุน ุจุฑูุฒุฑุณุงู ุขูุงุฑ
function refreshStats() {
    location.reload();
}

// ุชุงุจุน ฺุงูพ
window.addEventListener('beforeprint', function() {
    document.querySelectorAll('.btn').forEach(btn => {
        btn.style.display = 'none';
    });
});

window.addEventListener('afterprint', function() {
    document.querySelectorAll('.btn').forEach(btn => {
        btn.style.display = '';
    });
});
</script>
{% endblock %}
